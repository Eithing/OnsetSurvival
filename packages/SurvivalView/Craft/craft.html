<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="craft.css" />
</head>

<body>
    <div class="parent-container">
        <div class="inventory-container-Global" id="player-inventory">
            <label class="title_label">Craft</label>
            <div class="inventory-container-SubGlobal">
                <div class="inventory-container scroll" id="inventory-container">

                </div>
                <div class="craft-container scroll" id="craft-container">
                    <div id="itemcraft">Selectionner un craft</div>
                    <div class="buttons" style="background: none; cursor: default; margin-top: 5px;">
                        <div id="previous" style="margin-left: 5px; margin-right: 5px;"><</div>
                        <div id="bcraft" style="margin-left: 5px; margin-right: 5px;">Craft</div>
                        <div id="next" style="margin-left: 5px; margin-right: 5px;">></div>
                    </div>
                    <div id="needing" class="scroll needing" style="height: 170px; justify-content: flex-start; cursor: default;">
                    </div>
                </div>

                <div class="receipt-container scroll" id="receipt-container">

                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="./../Ressources/Js/craft.js"></script>
    <script type="text/javascript" src="./../Ressources/Js/item.js"></script>
    <script>
        try {
            ue == null
        } catch (err) {
            window.ue = {
                game: {
                    callevent: console.log
                }
            }
        }

        document.oncontextmenu = function() {
            return false;
        }

        function newEl(tagType) {
            return document.createElement(tagType);
        }

        var craftInventory = new Craft()

        let maxCraft = 64

        let craftid = document.getElementById("itemcraft").getAttribute('craft-id')
        document.getElementById("itemcraft").setAttribute('craft-count', 1)
        document.getElementById("bcraft").innerHTML = "Craft x1"

        document.getElementById("bcraft").addEventListener("click", function(event){
            event.preventDefault();
            ue.game.callevent("onCraft", JSON.stringify([document.getElementById("itemcraft").getAttribute('craft-id'), document.getElementById("itemcraft").getAttribute('craft-count')]));
        });

        document.getElementById("previous").addEventListener("click", function(event){
            event.preventDefault();
            let craftcount = parseInt(document.getElementById("itemcraft").getAttribute('craft-count'))
            ToggleCraft(craftcount - 1)
        });

        document.getElementById("next").addEventListener("click", function(event){
            event.preventDefault();
            let craftcount = parseInt(document.getElementById("itemcraft").getAttribute('craft-count'))
            ToggleCraft(craftcount + 1)
        });

        function ToggleCraft(num){
            if(num < 1){
                num = 1
            }else if(num > maxCraft){
                num = maxCraft
            }
            document.getElementById("itemcraft").setAttribute('craft-count', num)
            document.getElementById("bcraft").innerHTML = "Craft x"+num

            if(craftInventory.receipts.current != 0){
                let currentReceipt = craftInventory.receipts.receipt[craftInventory.receipts.current]
                if(currentReceipt.type == "cars"){
                    document.getElementById("itemcraft").setAttribute('craft-count', 1)
                    document.getElementById("bcraft").innerHTML = "Craft x"+1
                    return num
                }
                document.getElementById("itemcraft").innerHTML = currentReceipt.name
                document.getElementById("itemcraft").setAttribute('craft-id', currentReceipt.craftid)
                document.getElementById("needing").innerHTML = ""
                currentReceipt.need.forEach(element => {
                    let needp = newEl('p');
                    let craftcount = parseInt(document.getElementById("itemcraft").getAttribute('craft-count'))
                    let count = parseInt(element.count)*craftcount
                    needp.innerHTML = count+" "+element.name
                    document.getElementById("needing").appendChild(needp)
                });
            }

            return num
        }
    </script>
</body>
</html>